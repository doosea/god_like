# 清华 操作系统原理
- [清华 操作系统原理](https://www.bilibili.com/video/BV1uW411f72n?p=2)
- [操作系统](https://blog.csdn.net/iwanderu/article/details/103934127)

## charpter1 什么是操作系统
1. Linux，Windows界面属于外壳shell(与User交互),操作系统研究的是内核，处于Shell之下。
2. 操作系统内部组件
    - CPU调度器
    - 物理内存管理
    - 虚拟内存管理
    - 文件系统管理
    - 中断处理与设备驱动
3. 操作系统特征
    - 并发： 一段时间内运行多个进程
    - 并行 : 一个时间点运行多个进程，一般要求有多个CPU
    - 共享： “同时”共享 / 互斥共享
    - 虚拟： 让每一个用户觉得的有一个计算机专门为他服务
    - 异步： 程序是走走停停，而不是一直运行
    
## charpter2  操作系统基础操作 （操作系统的异常/中断/系统调用）
1. 操作系统的启动
    - Disk : 存放OS和Bootloader
    - BIOS : 基本I/O处理系统( basic I/O system)
    - Bootloader : 加载OS，将OS放入内存   
2. 中断/异常和系统调用
    - 中断：(来源于外设)来自不同的硬件设备的计时器和网络的中断。
    - 异常：(来源于不良的应用程序)非法指令或其它花的处理状态(e.g.内存出错)。
    - 系统调用：(来源于应用程序)应用程序主动向操作系统发出服务请求
        - 一条指令会触发一个系统调用
        - 程序访问主要是通过高层次的API接口而不是直接进行系统调用。
        - 用户态：应用程序在执行的过程中，CPU执行的特权级的状态(很低，不能访问特殊机器指令和IO)
        - 内核态：应用程序在执行的过程中，CPU执行的特权级的状态(高，操作系统可以执行CPU任何一条指令)。
        - 系统调用时涉及到特权级从用户态到内核态的转换，应用程序和操作系统有各自的堆栈，这两个变化比函数调用的开销更大，
        但更安全和可靠。(而程序调用是在一个栈空间实现参数的调用和返回)。
## Chapter3 连续式内存分配
1. 计算机体系结构
    - CPU
    - 内存
    - IO        
2. 内存分层体系
    - CPU 寄存器 / L1 缓存
    - L2缓存
    - 主存
    - 磁盘
3. 地址空间
    - 物理地址空间 —— 硬件支持的地址空间( address : [0, Max_sys] )
    - 逻辑地址空间 —— 一个运行在程序所拥有的的内存范围( address : [0, Max_prog] )   
4. 分区的动态分配
    - 第一匹配分配 : 在内存中找到第一个比需求大的空闲块, 分配给应用程序
    - 最优适配分配 : 在内存中找到最小的空闲块, 分配给应用程序
    - 最差适配分配 : 在内存中找到最大的空闲块, 分配给应用程序
5. 碎片整理方法
    - 压缩式碎片整理
    - 交换式碎片整理
## Chapter4 非连续式内存分配
1. 分段  Segmentation： 逻辑地址空间连续，但是物理地址空间不连续，使用映射机制进行关联.
    - 一个段 : 一个内存"块"
    - 程序访问内存地址需要 : 一个二维的二元组(s, addr) → (段号, 地址) 
    - 操作系统维护一张段表, 存储(段号, 物理地址中的起始地址, 长度限制)
    - 物理地址 : 段表中的起始地址 + 二元组中的偏移地址
2. 分页(Paging) 
    - 划分物理内存至固定大小的帧(Frame)： 大小是2的幂, 512 / 4096 / 8192
    - 划分逻辑地址空间至相同大小的页(Page)： 大小是2的幂, 512 / 4096 / 8192
    -  转换逻辑地址为物理地址(pages to frames)
        - 页表(Page Table)
        - MMU / TLB
3. 帧（Frame） : 物理地址计算方式
    - 物理内存被分割为大小相等的帧. 一个内存物理地址是一个二元组(f, o) → (帧号, 帧内偏移)
    - 物理地址 = 2^S * f + o
        - 帧号 : F位, 共有2^F个帧
        - 帧内偏移 : S位, 每帧有2^S个字节
4. 页(Page)  ： 
    - 一个程序的逻辑地址空间被划分为大小相等的页. 页内偏移的大小 = 帧内偏移的大小 页号大小 <> 帧号大小
    - 一个逻辑地址是一个二元组(p, o) → (页号, 页内偏移)
    - 虚拟地址 = 2^S * p + o
        - 页号 : P位, 共有2^P个页
        - 页内偏移 : S位, 每页有2^S个字节
（P19）       
      